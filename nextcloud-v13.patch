diff -crB /original/nextcloud/lib/private/User/Backend.php /modified/nextcloud/lib/private/User/Backend.php
*** /original/nextcloud/lib/private/User/Backend.php	2018-02-20 11:00:00.316796734 +0100
--- /modified/nextcloud/lib/private/User/Backend.php	2018-02-20 12:00:00.828537353 +0100
***************
*** 49,55 ****
  
  	protected $possibleActions = array(
  		self::CREATE_USER => 'createUser',
- 		self::SET_PASSWORD => 'setPassword',
  		self::CHECK_PASSWORD => 'checkPassword',
  		self::GET_HOME => 'getHome',
  		self::GET_DISPLAYNAME => 'getDisplayName',
--- 49,54 ----
diff -crB /original/nextcloud/lib/private/User/Session.php /modified/nextcloud/lib/private/User/Session.php
*** /original/nextcloud/lib/private/User/Session.php	2018-02-20 11:00:00.316796734 +0100
--- /modified/nextcloud/lib/private/User/Session.php	2018-02-20 12:00:00.828537353 +0100
***************
*** 589,595 ****
			// Ignore and use empty string instead
		}

-		$this->manager->emit('\OC\User', 'preLogin', array($uid, $password));
-
		$user = $this->manager->get($uid);
		if (is_null($user)) {
--- 589,594 ----
diff -crB /original/nextcloud/lib/private/User/Session.php /modified/nextcloud/lib/private/User/Session.php
*** /original/nextcloud/private/User/Session.php	2018-02-20 11:00:00.316796734 +0100
--- /modified/nextcloud/lib/private/User/Session.php	2018-02-20 12:00:00.828537353 +0100
***************
*** 399,404 ****
				$this->manager->emit('\OC\User', 'preLogin', array($user, $password));
			}

+			if ($this->isLoggedIn()) {
+				return true;
+			}
+
			$isTokenPassword = $this->isTokenPassword($password);
			if (!$isTokenPassword && $this->isTokenAuthEnforced()) {
				throw new PasswordLoginForbiddenException();
--- 399,408 ----
diff -crB /original/nextcloud/lib/private/User/Session.php /modified/nextcloud/lib/private/User/Session.php
*** /original/nextcloud/private/User/Session.php	2018-02-20 11:00:00.316796734 +0100
--- /modified/nextcloud/lib/private/User/Session.php	2018-02-20 12:00:00.828537353 +0100
***************
*** 330,335 ****
	 * @throws LoginException
	 */
	public function login($uid, $password) {
+		if ($this->isLoggedIn()) {
+			return true;
+		}
		$this->session->regenerateId();
		if ($this->validateToken($password, $uid)) {
			return $this->loginWithToken($password);
--- 330,338 ----
diff -crB /original/nextcloud/core/Controller/LoginController.php /modified/nextcloud/core/Controller/LoginController.php
*** /original/nextcloud/core/Controller/LoginController	2018-02-20 11:00:00.316796734 +0100
--- /modified/nextcloud/core/Controller/LoginController	2018-02-20 12:00:00.828537353 +0100
***************
*** 308,314 ****
			}
		}

!		if ($loginResult === false) {
			$this->logger->warning('Login failed: \''. $user .
				'\' (Remote IP: \''. $this->request->getRemoteAddress(). '\')',
				['app' => 'core']);
--- 308,314 ----
			}
		}

!		if ($loginResult === false && !$this->userSession->isLoggedIn()) {
			$this->logger->warning('Login failed: \''. $user .
				'\' (Remote IP: \''. $this->request->getRemoteAddress(). '\')',
				['app' => 'core']);
